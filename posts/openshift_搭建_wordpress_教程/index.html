<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>openshift 搭建 wordpress 教程</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
</head>
<body>
	<header>
	<a href="https://marguerite.github.io">Marguerite Su: Golang/Ruby Programmer, openSUSE Member</a>
	
</header>

	
	<main>
		<article>
			<h1>openshift 搭建 wordpress 教程</h1>
			<time>18.02.2013 00:00</time>
			<div>
				<p>最近把 suse.ws 搬家到了 Red Hat 的 openshift.com。原因是我个人博客的空间 IP 也被光荣认证了，而 openSUSE 简体中文官方主站不能在简体中文地区不能访问呀。又没有赞助就选了搞基的红帽子搞的 PaaS。</p>
<p>下面把搭建时候的要点简单说一下。</p>
<h4 id="准备">准备</h4>
<p>你要有一个 openshift 账户。每个账户可以开三个 Gear，共享 3 GB 硬盘和 1.5 GB 内存（VPS 泪流满面）。</p>
<p>你要会 Git 基本命令。比如 git clone，git add，git rm，git commit。不会的快去学习 codeschool 的免费课程 <a href="http://www.codeschool.com/courses/try-git">Try Git</a>，半个小时包教包会。</p>
<p>你要安装 <a href="https://rvm.io">rvm</a>  和 ruby，然后安装 openshift 的命令行客户端 <a href="https://openshift.redhat.com/community/get-started">rhc</a>，具体的 Ruby 新新人指南可以看我的<a href="http://www.marguerite.su/2012/11/11/ruby-on-rails-hello-world/">上一篇文章</a>。</p>
<h4 id="安装-wordpress">安装 WordPress</h4>
<p><a href="http://heylinux.com/archives/956.html">生成 ssh 密钥对</a>并把公共密钥贴到 openshift 去。</p>
<p>申请一个 Gear，选 wordpress。然后看需要可以添加一个 phpMyAdmin 的 Cartridge。把它给你的数据库 root 用户名和密码以及数据库名记在小本本上别弄丢了。</p>
<p><code>git clone</code> 返回给你的那个 repo，php/wp-config-example.php 改成 php/wp-config.php，把里面的数据库名、root 用户名和密码安装上面的填了。WPLANG 愿意改改一下。</p>
<p>提交一次，留意命令行中的信息，会说数据库的 IP。</p>
<p>然后再到 php/wp-config.php 里把 DB_HOST 改对。用 localhost 是不行的。</p>
<p>接下来就是 wordpress 的 5 分钟安装了。</p>
<h4 id="绑定域名">绑定域名</h4>
<p>先配置您的域名的 A 记录。建议最好在域名注册商那里把 NS 记录改成一些免费的 DNS 服务商的 NS 记录，然后在 DNS 服务商的面板里配置（注册商可配置的东西特别少）。比如我的是 cloudns.net。ping 一下 openshift 给你分配的那个 appname-username.rhcloud.com 的二级域名，得到一个 IP 地址。把带 www 和不带 www 的域名的 A 记录都设为那个 IP。</p>
<p>然后安装 rvm 和 ruby 后 <code>gem install rhc</code>。您可能需要</p>
<pre><code>export PATH=$PATH:/home/marguerite/.rvm/gems/ruby-1.9.3-p374/bin
</code></pre>
<p>才能使用 rhc（Linux 下）。</p>
<p><code>rhc alias add appname 你的域名</code>可以绑定域名，把带 www 和不带 www 的都绑定上。</p>
<p><em><strong>注意</strong></em>：</p>
<ol>
<li>rhc 可能需要你在本地 ssh 里有你刚生成的那个 ssh 才能正常使用</li>
<li>openshift 给你分配的二级域名免费送了一个 https，你千万不要傻到在 WordPress 的 General 设置里<em><strong>把自己的主域名也输入成 https://</strong></em>，那样你访问站点的时候 css/js 什么的统统加载不出来的。因为 https 只适用于二级域名，你那个域名不行。</li>
</ol>
<h4 id="升级和备份-皮肤插件上传文件等">升级和备份 （皮肤、插件、上传文件等）</h4>
<p><em><strong>绝对要看！不然您会发现 WordPress 有各种各样的问题，比如再次本地提交后之前上传的图片显示不出来了啊之类的。</strong></em></p>
<p>openshift 有一个比较神秘的地方在于，你使用 git 管理。但平时你是在 WordPress 后台进行操作的，所以就产生了下面的问题：</p>
<p>***你发现你在后台修改的内容是没法 git pull 取回本地的！***比如你升级了 wordpress 版本，然后在本地 git 仓库里改了下主题，一提交发现你的 wordpress 没有升级！</p>
<p>Red Hat 给出的解释是说：那些叫运行时修改，是跳过 git 的。有以下几个办法可以解决，从难到易：</p>
<ol>
<li>
<p>ssh 登录进去，把那些东西都复制到一个文件夹里，tar 压缩那个文件夹，在网页里面下载回来添加到 git。这个不说太具体，和 VPS 的管理一样，您既然都会 ssh 远程登录了，是吧。</p>
</li>
<li>
<p>使用 <code>rhc app snapshot save -a {appName}</code> 把当前 Gear 的快照下载回来，用 app_root/repo 里面的东西覆盖到 git。然后添加、提交。</p>
</li>
<li>
<p>使用配置文件：</p>
</li>
</ol>
<p>你会在你的 git 仓库里发现这样一个隐藏文件：<code>.openshift/action_hooks/build</code></p>
<p>里面有这样的内容：</p>
<pre><code>if [ ! -d $OPENSHIFT_DATA_DIR/uploads ]; then
        mkdir $OPENSHIFT_DATA_DIR/uploads
fi

ln -sf $OPENSHIFT_DATA_DIR/uploads $OPENSHIFT_REPO_DIR/php/wp-content/
</code></pre>
<p>这段内容的作用就是把 uploads 文件夹作为 DATA_DIR。DATA_DIR 的内容是不会被 git 管理也不会被 git 修改的。所以我们照样子抄然后把 uploads 替换为我们的内容比如 themes 和 plugins 即可。</p>
<p>注意：此方法有一个缺点就是还是无法应对升级，另外就是如果你把那些文件夹添加为 DATA_DIR 会产生一个问题就是你发现除了万能的 ssh 运程登录，你几乎没有办法再修改它，相当于一个丢失了 FTP 功能的 PHP 空间，只能在线运行，没法备份和管理。<em><strong>不要有侥幸心态觉得我这个博客就一直放在这里不动，可以负责任的说您的博客多运行一天，您再出问题进行修复或迁移的难度就增加一分。</strong></em></p>
<p>所以个人比较推荐第二种方法。</p>
<h4 id="参考文献">参考文献</h4>
<ul>
<li><a href="https://access.redhat.com/knowledge/docs/en-US/OpenShift/2.0/html/User_Guide/index.html">openshift 用户手册</a></li>
<li><a href="https://openshift.redhat.com/community/forums/openshift/one-newbie-question">https://openshift.redhat.com/community/forums/openshift/one-newbie-question</a></li>
<li><a href="http://www.i7086.com/openshiftbangdingdingjiyuming">OpenShift免费空间绑定顶级域名（图文教程）</a></li>
</ul>
<h4 id="小结">小结</h4>
<p>以上。</p>
<p>至少我现在的 suse.ws 还没有任何问题地倔强地狂奔在 openshift 上。</p>

			</div>
			
			<div>
				

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "innamoramento" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/color_emoji_in_opensuse/">Color Emoji in openSUSE</a></li>
				
				<li><a href="/posts/fontconfig_%E5%87%A0%E4%B8%AA%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9D%91/">fontconfig 几个常见的坑</a></li>
				
				<li><a href="/posts/30_%E7%A7%92%E9%92%9F%E5%9C%A8_github_pages_%E4%B8%8A%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA_opensuse_%E9%A3%8E%E6%A0%BC%E7%9A%84%E9%83%A8%E8%90%BD%E6%A0%BC/">30 秒钟在 Github Pages 上搭建一个 openSUSE 风格的部落格</a></li>
				
				<li><a href="/posts/introducing_the_brand_new_nodejs_packaging/">Introducing the brand new nodejs packaging</a></li>
				
				<li><a href="/posts/%E6%9C%AC%E5%91%A8%E5%BC%80%E5%8F%91%E6%9C%AD%E8%AE%B0/">本周开发札记</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2020 <a href="https://marguerite.github.io">Marguerite Su: Golang/Ruby Programmer, openSUSE Member</a></p>
</footer>

</body>
</html>
